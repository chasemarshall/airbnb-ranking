function addSingleItemToAllProperties(item, toTop = false) {
            const allPropertiesContainer = document.getElementById('allPropertiesContainer');
            const newElement = createPropertyElement(item);
            
            if (toTop) {
                // Add to top with special animation
                newElement.style.transform = 'translateX(-50px) scale(0.9)';
                newElement.style.opacity = '0';
                
                allPropertiesContainer.insertBefore(newElement, allPropertiesContainer.firstChild);
                
                // Animate in
                setTimeout(() => {
                    newElement.style.transition = 'all 0.5s cubic-bezier(0.16, 1, 0.3, 1)';
                    newElement.style.transform = 'translateX(0) scale(1)';
                    newElement.style.opacity = '1';
                }, 50);
            } else {
                allPropertiesContainer.appendChild(newElement);
            }
        }<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ryan Trahan's 50 States Airbnb Ranking</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
            color: #e4e4e7;
            -webkit-font-smoothing: antialiased;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(40, 40, 40, 0.8);
            backdrop-filter: blur(20px);
            box-shadow: 0 0 60px rgba(0, 0, 0, 0.3);
        }

        .column {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .left-column {
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(30, 30, 30, 0.6);
        }

        .right-column {
            background: rgba(40, 40, 40, 0.6);
        }

        .column-header {
            padding: 24px 28px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(40, 40, 40, 0.8);
            backdrop-filter: blur(30px);
        }

        .search-container {
            padding: 16px 28px 0;
            background: rgba(30, 30, 30, 0.6);
        }

        .search-input {
            width: 100%;
            padding: 12px 16px;
            background: rgba(60, 60, 60, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: #ffffff;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: rgba(59, 130, 246, 0.5);
            background: rgba(60, 60, 60, 0.6);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .column-title {
            font-size: 24px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 4px;
            letter-spacing: -0.02em;
        }

        .column-subtitle {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 400;
        }

        .items-container {
            flex: 1;
            overflow-y: auto;
            padding: 16px 28px 28px;
        }

        .items-container::-webkit-scrollbar {
            width: 6px;
        }

        .items-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .items-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }

        .items-container::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .property-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            margin: 0 0 8px;
            background: rgba(60, 60, 60, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            cursor: grab;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            user-select: none;
            position: relative;
            backdrop-filter: blur(10px);
        }

        .property-item:hover:not(.dragging) {
            background: rgba(80, 80, 80, 0.5);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px) scale(1.01);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .property-item:active {
            cursor: grabbing;
        }

        .property-item.dragging {
            opacity: 0.9;
            transform: scale(1.05) rotate(2deg);
            z-index: 1000;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            border-color: rgba(59, 130, 246, 0.5);
            background: rgba(80, 80, 80, 0.8);
        }

        .ranked-item {
            background: rgba(59, 130, 246, 0.15);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .ranked-item:hover:not(.dragging) {
            background: rgba(59, 130, 246, 0.25);
            border-color: rgba(59, 130, 246, 0.4);
        }

        .property-content {
            flex: 1;
        }

        .state-name {
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 2px;
            letter-spacing: -0.01em;
        }

        .property-name {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.3;
            font-weight: 400;
        }

        .rank-number {
            font-size: 16px;
            font-weight: 600;
            color: rgba(59, 130, 246, 1);
            min-width: 28px;
            text-align: center;
            background: rgba(59, 130, 246, 0.2);
            border-radius: 8px;
            padding: 6px 8px;
            margin-left: 16px;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .rank-number.top {
            background: rgba(251, 191, 36, 0.2);
            border-color: rgba(251, 191, 36, 0.4);
            color: #fbbf24;
        }

        .drop-indicator {
            height: 2px;
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.8), rgba(6, 182, 212, 0.8));
            border-radius: 2px;
            margin: 4px 0;
            opacity: 0;
            transform: scaleX(0);
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 0 12px rgba(59, 130, 246, 0.4);
        }

        .drop-indicator.active {
            opacity: 1;
            transform: scaleX(1);
        }

        .empty-state {
            text-align: center;
            padding: 60px 32px;
            color: rgba(255, 255, 255, 0.5);
            font-size: 16px;
            font-weight: 400;
            line-height: 1.5;
        }

        .empty-emoji {
            font-size: 48px;
            margin-bottom: 16px;
            display: block;
            opacity: 0.7;
        }

        .instructions {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            padding: 12px 20px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            font-weight: 400;
            background: rgba(40, 40, 40, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(20px);
        }

        /* Save indicator */
        .save-indicator {
            position: fixed;
            top: 24px;
            right: 24px;
            background: rgba(16, 185, 129, 0.9);
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            opacity: 0;
            transform: translateY(-20px) scale(0.9);
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .save-indicator.show {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        /* Individual item animations */
        .property-item.item-moving {
            transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.3s ease;
        }

        .property-item.item-entering {
            animation: slideInSoft 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .property-item.item-leaving {
            animation: slideOutSoft 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        .property-item.item-leaving-right {
            animation: slideOutRight 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        .property-item.item-leaving-left {
            animation: slideOutLeft 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        @keyframes slideInSoft {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes slideOutSoft {
            from {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            to {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
        }

        @keyframes slideOutRight {
            from {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
            to {
                opacity: 0;
                transform: translateX(100px) scale(0.9);
            }
        }

        @keyframes slideOutLeft {
            from {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
            to {
                opacity: 0;
                transform: translateX(-100px) scale(0.9);
            }
        }

        /* Rank badges */
        .rank-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: rgba(251, 191, 36, 0.9);
            color: white;
            border-radius: 12px;
            padding: 4px 8px;
            font-size: 11px;
            font-weight: 600;
            border: 2px solid rgba(40, 40, 40, 0.8);
            backdrop-filter: blur(10px);
        }

        .rank-badge.first {
            background: rgba(251, 191, 36, 0.9);
        }

        .rank-badge.second {
            background: rgba(156, 163, 175, 0.9);
        }

        .rank-badge.third {
            background: rgba(205, 124, 47, 0.9);
        }

        /* Smooth placeholder */
        .reorder-placeholder {
            background: rgba(59, 130, 246, 0.1);
            border: 2px dashed rgba(59, 130, 246, 0.4);
            border-radius: 12px;
            height: 60px;
            margin: 4px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(59, 130, 246, 0.8);
            font-size: 14px;
            font-weight: 400;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            backdrop-filter: blur(10px);
        }

        /* Soft hover effects */
        .property-item .state-name {
            transition: color 0.3s ease;
        }

        .property-item:hover .state-name {
            color: rgba(59, 130, 246, 1);
        }

        .ranked-item:hover .state-name {
            color: #ffffff;
        }
    </style>
</head>
<body>
    <div class="save-indicator" id="saveIndicator">✅ Saved</div>
    
    <div class="container">
        <!-- Left Column: All Properties -->
        <div class="column left-column">
            <div class="column-header">
                <div class="column-title">All Properties</div>
                <div class="column-subtitle" id="allPropertiesCount">50 from Ryan's journey</div>
            </div>
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Search properties..." id="searchInput">
            </div>
            <div class="items-container" id="allPropertiesContainer">
                <!-- Items will be populated by JavaScript -->
            </div>
        </div>

        <!-- Right Column: Rankings -->
        <div class="column right-column">
            <div class="column-header">
                <div class="column-title">Your Rankings</div>
                <div class="column-subtitle" id="rankingsCount">Drag properties here to rank them</div>
            </div>
            <div class="items-container" id="rankingsContainer">
                <div class="empty-state">
                    <span class="empty-emoji">🏆</span>
                    Drag your favorite properties from the left to start ranking!
                </div>
            </div>
        </div>
    </div>

    <div class="instructions">
        💡 Drag properties between columns • Reorder within rankings • Drag back to remove from rankings
    </div>

    <script>
        const airbnbData = [
            { state: "Hawaii", property: "Ocean Front Home" },
            { state: "Arizona", property: "Norman Lykes House" },
            { state: "Oklahoma", property: "Treetopia Treehouse" },
            { state: "New Jersey", property: "Private Island" },
            { state: "South Carolina", property: "Charleston Waterfront" },
            { state: "Louisiana", property: "Ponchatoula Estate" },
            { state: "Colorado", property: "Container Ranch" },
            { state: "Rhode Island", property: "The Fairy House" },
            { state: "California", property: "The Castle Ivar" },
            { state: "West Virginia", property: "Bearwood" },
            { state: "Illinois", property: "Factory Home" },
            { state: "Massachusetts", property: "Wing Neck Lighthouse" },
            { state: "Minnesota", property: "The Pump House" },
            { state: "Montana", property: "Yellowstone" },
            { state: "Iowa", property: "Pyramid House" },
            { state: "Tennessee", property: "Belltop" },
            { state: "Alaska", property: "Aurora House" },
            { state: "North Carolina", property: "Luxury Yacht" },
            { state: "Oregon", property: "Rummer House" },
            { state: "Ohio", property: "The Roca Box Hop" },
            { state: "Florida", property: "Prince Road Container House" },
            { state: "Maine", property: "Copper Fox Treehouse" },
            { state: "Maryland", property: "Waterfront Barn" },
            { state: "Virginia", property: "Ava A-Frame" },
            { state: "Missouri", property: "Earthhouse Retreat" },
            { state: "Vermont", property: "Glass Tiny House" },
            { state: "New York", property: "Willow Treehouse" },
            { state: "Wisconsin", property: "WW2 Airplane" },
            { state: "Georgia", property: "Lookout Tower" },
            { state: "Nevada", property: "Presidential Suite" },
            { state: "New Mexico", property: "The Missile Silo" },
            { state: "North Dakota", property: "Bison Ranch Lodge" },
            { state: "Mississippi", property: "The Pool House" },
            { state: "Texas", property: "The Nut House" },
            { state: "Michigan", property: "Frank Lloyd House" },
            { state: "Connecticut", property: "River Loft" },
            { state: "Arkansas", property: "Nuclear Missile Complex" },
            { state: "Wyoming", property: "Snowflake Cabin" },
            { state: "Alabama", property: "Storybook Castle" },
            { state: "Pennsylvania", property: "Round House" },
            { state: "Idaho", property: "Potato" },
            { state: "Kentucky", property: "Stable Suite" },
            { state: "New Hampshire", property: "Lil Red Caboose" },
            { state: "Indiana", property: "Cabin off 39" },
            { state: "Washington", property: "Space Destination" },
            { state: "Utah", property: "Star Wars Hut" },
            { state: "Kansas", property: "Zome on the Range" },
            { state: "Nebraska", property: "The Corny Cabin" },
            { state: "Delaware", property: "Tiny House at Good Earth" },
            { state: "South Dakota", property: "Hillview Lodge" }
        ];

        let rankedItems = [];
        let draggedElement = null;
        let draggedFromRanked = false;
        let placeholder = null;
        let searchTerm = '';

        // Cookie functions
        function saveToCookie() {
            const rankings = rankedItems.map(item => item.state);
            document.cookie = `airbnb_rankings=${JSON.stringify(rankings)}; expires=${new Date(Date.now() + 365*24*60*60*1000).toUTCString()}; path=/`;
            showSaveIndicator();
        }

        function loadFromCookie() {
            const cookies = document.cookie.split(';');
            const rankingCookie = cookies.find(cookie => cookie.trim().startsWith('airbnb_rankings='));
            
            if (rankingCookie) {
                try {
                    const rankings = JSON.parse(rankingCookie.split('=')[1]);
                    rankedItems = rankings.map(state => airbnbData.find(item => item.state === state)).filter(Boolean);
                } catch (e) {
                    console.log('Could not load rankings from cookie');
                }
            }
        }

        function showSaveIndicator() {
            const indicator = document.getElementById('saveIndicator');
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }

        function createPropertyElement(item, isRanked = false, rank = null) {
            const div = document.createElement('div');
            div.className = `property-item ${isRanked ? 'ranked-item' : ''} item-entering`;
            div.draggable = true;
            div.dataset.state = item.state;
            
            // Add rank badge for top 3
            const rankBadge = isRanked && rank <= 3 ? 
                `<div class="rank-badge ${rank === 1 ? 'first' : rank === 2 ? 'second' : 'third'}">
                    ${rank === 1 ? '🥇' : rank === 2 ? '🥈' : '🥉'}
                </div>` : '';
            
            div.innerHTML = `
                ${rankBadge}
                <div class="property-content">
                    <div class="state-name">${item.state}</div>
                    <div class="property-name">${item.property}</div>
                </div>
                ${isRanked ? `<div class="rank-number ${rank === 1 ? 'top' : ''}">${rank}</div>` : ''}
            `;

            // Add event listeners
            div.addEventListener('dragstart', handleDragStart);
            div.addEventListener('dragend', handleDragEnd);
            div.addEventListener('dragover', handleDragOver);

            return div;
        }

        function createPlaceholder() {
            const placeholder = document.createElement('div');
            placeholder.className = 'reorder-placeholder';
            placeholder.textContent = 'Drop here';
            return placeholder;
        }

        function handleDragStart(e) {
            draggedElement = e.target.closest('.property-item');
            draggedElement.classList.add('dragging');
            
            const rankingsContainer = document.getElementById('rankingsContainer');
            draggedFromRanked = rankingsContainer.contains(draggedElement);
            
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            if (draggedElement) {
                draggedElement.classList.remove('dragging');
                removePlaceholder();
                draggedElement = null;
                draggedFromRanked = false;
            }
        }

        function handleDragOver(e) {
            e.preventDefault();
            
            if (!draggedElement) return;
            
            const rankingsContainer = document.getElementById('rankingsContainer');
            
            // Only show placeholder when dragging ranked items within rankings
            if (draggedFromRanked && rankingsContainer.contains(e.target)) {
                const rect = rankingsContainer.getBoundingClientRect();
                const y = e.clientY - rect.top;
                
                const items = Array.from(rankingsContainer.querySelectorAll('.property-item:not(.dragging)'));
                let insertBeforeItem = null;
                
                for (let item of items) {
                    const itemRect = item.getBoundingClientRect();
                    const itemY = itemRect.top - rect.top + itemRect.height / 2;
                    
                    if (y < itemY) {
                        insertBeforeItem = item;
                        break;
                    }
                }
                
                showPlaceholder(insertBeforeItem);
            } else {
                removePlaceholder();
            }
        }

        function showPlaceholder(insertBeforeItem) {
            removePlaceholder();
            
            const rankingsContainer = document.getElementById('rankingsContainer');
            placeholder = createPlaceholder();
            
            if (insertBeforeItem) {
                rankingsContainer.insertBefore(placeholder, insertBeforeItem);
            } else {
                rankingsContainer.appendChild(placeholder);
            }
        }

        function removePlaceholder() {
            if (placeholder && placeholder.parentNode) {
                placeholder.parentNode.removeChild(placeholder);
                placeholder = null;
            }
        }

        function addSingleItemToRanked(item, insertPosition = null) {
            if (insertPosition !== null) {
                rankedItems.splice(insertPosition, 0, item);
            } else {
                rankedItems.push(item);
            }
            
            // Create and insert the new element
            const newElement = createPropertyElement(item, true, insertPosition !== null ? insertPosition + 1 : rankedItems.length);
            const rankingsContainer = document.getElementById('rankingsContainer');
            
            // Remove empty state if it exists
            const emptyState = rankingsContainer.querySelector('.empty-state');
            if (emptyState) {
                emptyState.remove();
            }
            
            // Insert at correct position
            if (insertPosition !== null && insertPosition < rankingsContainer.children.length) {
                rankingsContainer.insertBefore(newElement, rankingsContainer.children[insertPosition]);
            } else {
                rankingsContainer.appendChild(newElement);
            }
            
            // Update rank numbers for all items
            updateRankNumbers();
            updateCounts();
            saveToCookie();
        }

        function removeSingleItemFromRanked(element) {
            const state = element.dataset.state;
            const itemIndex = rankedItems.findIndex(item => item.state === state);
            
            if (itemIndex !== -1) {
                rankedItems.splice(itemIndex, 1);
                
                // Animate removal to the left
                element.classList.add('item-leaving-left');
                
                setTimeout(() => {
                    element.remove();
                    
                    // Add to top of all properties
                    const item = airbnbData.find(item => item.state === state);
                    addSingleItemToAllProperties(item, true);
                    
                    // Update rank numbers
                    updateRankNumbers();
                    updateCounts();
                    saveToCookie();
                    
                    // Show empty state if needed
                    if (rankedItems.length === 0) {
                        showEmptyState();
                    }
                }, 500);
            }
        }



        function updateRankNumbers() {
            const rankingsContainer = document.getElementById('rankingsContainer');
            const items = rankingsContainer.querySelectorAll('.property-item');
            
            items.forEach((item, index) => {
                const rankNumber = item.querySelector('.rank-number');
                if (rankNumber) {
                    rankNumber.textContent = index + 1;
                    rankNumber.className = `rank-number ${index === 0 ? 'top' : ''}`;
                }
                
                // Update badges
                const existingBadge = item.querySelector('.rank-badge');
                if (existingBadge) {
                    existingBadge.remove();
                }
                
                if (index < 3) {
                    const badge = document.createElement('div');
                    badge.className = `rank-badge ${index === 0 ? 'first' : index === 1 ? 'second' : 'third'}`;
                    badge.textContent = index === 0 ? '🥇' : index === 1 ? '🥈' : '🥉';
                    item.appendChild(badge);
                }
            });
        }

        function showEmptyState() {
            const rankingsContainer = document.getElementById('rankingsContainer');
            
            // Check if empty state already exists
            if (rankingsContainer.querySelector('.empty-state')) {
                return;
            }
            
            const emptyState = document.createElement('div');
            emptyState.className = 'empty-state';
            emptyState.innerHTML = `
                <span class="empty-emoji">🏆</span>
                Drag your favorite properties from the left to start ranking!
            `;
            rankingsContainer.appendChild(emptyState);
        }

        function renderAllProperties() {
            const container = document.getElementById('allPropertiesContainer');
            const unrankedItems = airbnbData.filter(item => 
                !rankedItems.find(ranked => ranked.state === item.state)
            );
            
            // Filter by search term
            const filteredItems = unrankedItems.filter(item =>
                item.state.toLowerCase().includes(searchTerm.toLowerCase()) ||
                item.property.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            container.innerHTML = '';
            filteredItems.forEach((item, index) => {
                setTimeout(() => {
                    container.appendChild(createPropertyElement(item));
                }, index * 15);
            });
        }

        function renderRankings() {
            const container = document.getElementById('rankingsContainer');
            
            // Clear container completely
            container.innerHTML = '';
            
            if (rankedItems.length === 0) {
                showEmptyState();
            } else {
                rankedItems.forEach((item, index) => {
                    const element = createPropertyElement(item, true, index + 1);
                    container.appendChild(element);
                });
            }
        }

        function updateCounts() {
            const allPropertiesCount = document.getElementById('allPropertiesCount');
            const rankingsCount = document.getElementById('rankingsCount');
            
            const remaining = 50 - rankedItems.length;
            const ranked = rankedItems.length;
            
            if (remaining === 0) {
                allPropertiesCount.textContent = 'All ranked! 🎉';
                rankingsCount.textContent = 'Complete ranking of 50 properties';
            } else if (ranked === 0) {
                allPropertiesCount.textContent = '50 from Ryan\'s journey';
                rankingsCount.textContent = 'Drag properties here to rank them';
            } else {
                allPropertiesCount.textContent = `${remaining} remaining`;
                rankingsCount.textContent = `${ranked} ranked`;
            }
        }

        // Setup drop zones
        function setupDropZones() {
            const rankingsContainer = document.getElementById('rankingsContainer');
            const allPropertiesContainer = document.getElementById('allPropertiesContainer');
            
            // Rankings container drop zone
            rankingsContainer.addEventListener('dragover', (e) => {
                e.preventDefault();
                
                if (!draggedElement) return;
                
                // Show drop zones when dragging over the container
                const rect = rankingsContainer.getBoundingClientRect();
                const y = e.clientY - rect.top;
                
                // Find the item we're hovering near
                const items = Array.from(rankingsContainer.querySelectorAll('.property-item:not(.dragging)'));
                let insertBeforeItem = null;
                
                for (let item of items) {
                    const itemRect = item.getBoundingClientRect();
                    const itemY = itemRect.top - rect.top + itemRect.height / 2;
                    
                    if (y < itemY) {
                        insertBeforeItem = item;
                        break;
                    }
                }
                
                showPlaceholder(insertBeforeItem, y);
            });
            
            rankingsContainer.addEventListener('drop', (e) => {
                e.preventDefault();
                
                if (!draggedElement) return;
                
                const draggedState = draggedElement.dataset.state;
                const item = airbnbData.find(item => item.state === draggedState);
                
                if (draggedFromRanked) {
                    // Reorder within ranked - find where to insert
                    let insertIndex = rankedItems.length;
                    
                    if (placeholder && placeholder.nextElementSibling) {
                        const nextElement = placeholder.nextElementSibling;
                        const nextState = nextElement.dataset.state;
                        insertIndex = rankedItems.findIndex(item => item.state === nextState);
                    }
                    
                    // Remove from old position
                    const oldIndex = rankedItems.findIndex(item => item.state === draggedState);
                    if (oldIndex !== -1) {
                        const [movedItem] = rankedItems.splice(oldIndex, 1);
                        
                        // Adjust insert index if moving from earlier position
                        if (oldIndex < insertIndex) {
                            insertIndex--;
                        }
                        
                        // Insert at new position
                        rankedItems.splice(insertIndex, 0, movedItem);
                        
                        // Re-render the rankings to show new order
                        renderRankings();
                        saveToCookie();
                    }
                    
                } else if (!draggedFromRanked && item) {
                    // Move from all properties to ranked
                    const elementToRemove = draggedElement;
                    elementToRemove.classList.add('item-leaving-right');
                    
                    setTimeout(() => {
                        if (elementToRemove && elementToRemove.parentNode) {
                            elementToRemove.remove();
                        }
                        
                        // Determine insert position based on placeholder
                        let insertPosition = rankedItems.length;
                        if (placeholder && placeholder.nextElementSibling) {
                            const nextState = placeholder.nextElementSibling.dataset.state;
                            insertPosition = rankedItems.findIndex(item => item.state === nextState);
                            if (insertPosition === -1) insertPosition = rankedItems.length;
                        }
                        
                        addSingleItemToRanked(item, insertPosition);
                    }, 500);
                }
                
                removePlaceholder();
            });
            
            // All properties container drop zone
            allPropertiesContainer.addEventListener('dragover', (e) => {
                e.preventDefault();
            });
            
            allPropertiesContainer.addEventListener('drop', (e) => {
                e.preventDefault();
                
                if (draggedElement && draggedFromRanked) {
                    const elementToRemove = draggedElement;
                    removeSingleItemFromRanked(elementToRemove);
                }
            });
        }

        // Initialize
        function init() {
            loadFromCookie();
            renderAllProperties();
            renderRankings();
            updateCounts();
            setupDropZones();
            setupSearch();
        }

        // Setup search functionality
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            
            searchInput.addEventListener('input', (e) => {
                searchTerm = e.target.value;
                renderAllProperties();
            });
            
            // Clear search when items are moved
            searchInput.addEventListener('focus', () => {
                if (searchInput.value) {
                    searchInput.select();
                }
            });
        }

        init();
    </script>
</body>
</html>
